<meta content="width=device-width,initial-scale=.9,user-scalable=no"name=viewport><meta content=black name=theme-color><title>用戶變壓器定位</title><script src=proj4.js></script><script src=./jquery-3.3.1.min.js></script><link href=./style1.css id=theme rel=stylesheet tittle=style1><style></style><script>var latWGS84,lonWGS84,latTWD67TM2,lonTWD67TM2,gridTF;const idxLat=["2750000","2750000","2750000","2700000","2700000","2700000","2650000","2650000","2650000","2600000","2600000","2600000","2550000","2550000","2550000","2500000","2500000","2500000","2894000","2450000","2450000","2400000","2400000","2614000","2564000","2675800"],idxLon=["170000","250000","330000","170000","250000","330000","170000","250000","330000","090000","170000","250000","090000","170000","250000","090000","170000","250000","010000","170000","250000","170000","250000","275000","275000","010000"],alphabet=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];function openGM(){var e="https://www.google.com/maps/search/?api=1&query="+latWGS84.toFixed(6)+","+lonWGS84.toFixed(6);window.open(e,"_blank")}function openOSM(){var e="http://osm.org/?mlat="+latWGS84+"&mlon="+lonWGS84+"&#map=17/"+latWGS84+"/"+lonWGS84;window.open(e,"_blank")}function openNLSC(){var e="https://maps.nlsc.gov.tw/go/"+latWGS84+"/"+lonWGS84+"/";window.open(e,"_blank")}function openLINE(){var e="http://line.naver.jp/R/msg/text/?";e+=encodeURIComponent("電號：12-"+document.getElementById("customNum").value+"-"+document.getElementById("chkNum").value)+"%0D%0A"+encodeURIComponent("座標："+document.getElementById("inPole").value)+"%0D%0A"+("https://www.google.com/maps/search/?api=1&query="+latWGS84.toFixed(6)+","+lonWGS84.toFixed(6)),window.open(e,"_blank")}function calcChkNum(){document.getElementById("chkNum").value="";var e=document.getElementById("customNum").value.split(""),t=[2,1,2,1,2,1,2,1,2,1];if(8!=e.length)return document.getElementById("inPole").value="",void disableBtn();e.unshift(1,2);for(var n=0,o=0;o<e.length;o+=1)e[o]=e[o]*t[o],e[o]>9&&(e[o]-=9),n+=e[o];document.getElementById("chkNum").value=n%10,lookupGrid()}function lookupGrid(){str=document.getElementById("customNum").value;let e=BinSearch(rows,str,0,rows.length-1);e+1?(gridTF=rows[e][1],document.getElementById("inPole").value=gridTF,grid2twd67(),execConvert(),enableBtn()):(disableBtn(),document.getElementById("inPole").value="無此電號")}function grid2twd67(){grid=gridTF.toUpperCase();var e=+idxLat[alphabet.indexOf(grid[0])]+500*+(10*grid[3]+ +grid[4])+100*+alphabet.indexOf(grid[6])+10*+grid[8];11==grid.length&&(e+=+grid[10]);var t=+idxLon[alphabet.indexOf(grid[0])]+800*+(10*grid[1]+ +grid[2])+100*+alphabet.indexOf(grid[5])+10*+grid[7];11==grid.length&&(t+=+grid[9]),latTWD67TM2=e,lonTWD67TM2=t}function execConvert(){proj4.defs("EPSG:3828","+proj=tmerc +towgs84=-752,-358,-179,-.0000011698,.0000018398,.0000009822,.00002329 +lat_0=0 +lon_0=121 +x_0=250000 +y_0=0 +k=0.9999 +ellps=aust_SA  +units=公尺"),proj4.defs("EPSG:3828:Liouciou","+proj=tmerc +lat_0=0 +lon_0=121 +x_0=249180 +y_0=1590 +k=0.9999 +ellps=aust_SA  +units=公尺");var e,t=new proj4.Proj("EPSG:3828"),n=new proj4.Proj("EPSG:3828:Liouciou"),o=new proj4.Proj("EPSG:4326"),d=document.getElementById("customNum").value.toUpperCase();switch(d[0]){case"T":e=d.substr(1,2)<=20&&d.substr(3,2)<=50?n:t;break;default:e=t}var l=[Number(lonTWD67TM2),Number(latTWD67TM2)],a=proj4(e,o,l);lonWGS84=a[0],latWGS84=a[1]}function disableBtn(){document.getElementById("btnOpenGM").disabled=!0,document.getElementById("btnOpenOSM").disabled=!0,document.getElementById("btnOpenNLSC").disabled=!0,document.getElementById("btnOpenLINE").disabled=!0}function enableBtn(){document.getElementById("btnOpenGM").disabled=!1,document.getElementById("btnOpenOSM").disabled=!1,document.getElementById("btnOpenNLSC").disabled=!1,document.getElementById("btnOpenLINE").disabled=!1}function BinSearch(e,t,n,o){if(n>o)return-1;let d=Math.floor((n+o)/2);return e[d][0]===t?d:e[d]>t?BinSearch(e,t,n,d-1):BinSearch(e,t,d+1,o)}</script><div id=divForm><div id=divLogo></div><div id=divInGrid><center><input id=districtNum size=2 maxlength=2 readonly value=12> <input id=customNum size=11 maxlength=8 onchange=calcChkNum() oninput=calcChkNum() placeholder=用戶電號 type=search> <input id=chkNum size=1 maxlength=1 readonly></center></div><div id=divPole><input id=inPole size=11 readonly style=display:none></div><div id=divButton1><button class=button disabled id=btnOpenGM onclick=openGM() type=button></button> <button class=button disabled id=btnOpenOSM onclick=openOSM() type=button></button> <button class=button disabled id=btnOpenNLSC onclick=openNLSC() type=button></button> <button class=button disabled id=btnOpenLINE onclick=openLINE() type=button></button></div><script>var rows=[];document.getElementById("inPole").value="",$.getJSON("custom.json",(function(e){rows=e.slice()})).done((function(){document.getElementById("inPole").value="(1091209)"}﻿<meta content="width=device-width,initial-scale=.9,user-scalable=no"name=viewport><meta content=black name=theme-color><title>用戶變壓器定位</title><script src=proj4.js></script><script src=./jquery-3.3.1.min.js></script><link href=./style1.css id=theme rel=stylesheet tittle=style1><style></style><script>var latWGS84,lonWGS84,latTWD67TM2,lonTWD67TM2,gridTF;const idxLat=["2750000","2750000","2750000","2700000","2700000","2700000","2650000","2650000","2650000","2600000","2600000","2600000","2550000","2550000","2550000","2500000","2500000","2500000","2894000","2450000","2450000","2400000","2400000","2614000","2564000","2675800"],idxLon=["170000","250000","330000","170000","250000","330000","170000","250000","330000","090000","170000","250000","090000","170000","250000","090000","170000","250000","010000","170000","250000","170000","250000","275000","275000","010000"],alphabet=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];function openGM(){var e="https://www.google.com/maps/search/?api=1&query="+latWGS84.toFixed(6)+","+lonWGS84.toFixed(6);window.open(e,"_blank")}function openOSM(){var e="http://osm.org/?mlat="+latWGS84+"&mlon="+lonWGS84+"&#map=17/"+latWGS84+"/"+lonWGS84;window.open(e,"_blank")}function openNLSC(){var e="https://maps.nlsc.gov.tw/go/"+latWGS84+"/"+lonWGS84+"/";window.open(e,"_blank")}function openLINE(){var e="http://line.naver.jp/R/msg/text/?";e+=encodeURIComponent("電號：12-"+document.getElementById("customNum").value+"-"+document.getElementById("chkNum").value)+"%0D%0A"+encodeURIComponent("座標："+document.getElementById("inPole").value)+"%0D%0A"+("https://www.google.com/maps/search/?api=1&query="+latWGS84.toFixed(6)+","+lonWGS84.toFixed(6)),window.open(e,"_blank")}function calcChkNum(){document.getElementById("chkNum").value="";var e=document.getElementById("customNum").value.split(""),t=[2,1,2,1,2,1,2,1,2,1];if(8!=e.length)return document.getElementById("inPole").value="",void disableBtn();e.unshift(1,2);for(var n=0,o=0;o<e.length;o+=1)e[o]=e[o]*t[o],e[o]>9&&(e[o]-=9),n+=e[o];document.getElementById("chkNum").value=n%10,lookupGrid()}function lookupGrid(){str=document.getElementById("customNum").value;let e=BinSearch(rows,str,0,rows.length-1);e+1?(gridTF=rows[e][1],document.getElementById("inPole").value=gridTF,grid2twd67(),execConvert(),enableBtn()):(disableBtn(),document.getElementById("inPole").value="無此電號")}function grid2twd67(){grid=gridTF.toUpperCase();var e=+idxLat[alphabet.indexOf(grid[0])]+500*+(10*grid[3]+ +grid[4])+100*+alphabet.indexOf(grid[6])+10*+grid[8];11==grid.length&&(e+=+grid[10]);var t=+idxLon[alphabet.indexOf(grid[0])]+800*+(10*grid[1]+ +grid[2])+100*+alphabet.indexOf(grid[5])+10*+grid[7];11==grid.length&&(t+=+grid[9]),latTWD67TM2=e,lonTWD67TM2=t}function execConvert(){proj4.defs("EPSG:3828","+proj=tmerc +towgs84=-752,-358,-179,-.0000011698,.0000018398,.0000009822,.00002329 +lat_0=0 +lon_0=121 +x_0=250000 +y_0=0 +k=0.9999 +ellps=aust_SA  +units=公尺"),proj4.defs("EPSG:3828:Liouciou","+proj=tmerc +lat_0=0 +lon_0=121 +x_0=249180 +y_0=1590 +k=0.9999 +ellps=aust_SA  +units=公尺");var e,t=new proj4.Proj("EPSG:3828"),n=new proj4.Proj("EPSG:3828:Liouciou"),o=new proj4.Proj("EPSG:4326"),d=document.getElementById("customNum").value.toUpperCase();switch(d[0]){case"T":e=d.substr(1,2)<=20&&d.substr(3,2)<=50?n:t;break;default:e=t}var l=[Number(lonTWD67TM2),Number(latTWD67TM2)],a=proj4(e,o,l);lonWGS84=a[0],latWGS84=a[1]}function disableBtn(){document.getElementById("btnOpenGM").disabled=!0,document.getElementById("btnOpenOSM").disabled=!0,document.getElementById("btnOpenNLSC").disabled=!0,document.getElementById("btnOpenLINE").disabled=!0}function enableBtn(){document.getElementById("btnOpenGM").disabled=!1,document.getElementById("btnOpenOSM").disabled=!1,document.getElementById("btnOpenNLSC").disabled=!1,document.getElementById("btnOpenLINE").disabled=!1}function BinSearch(e,t,n,o){if(n>o)return-1;let d=Math.floor((n+o)/2);return e[d][0]===t?d:e[d]>t?BinSearch(e,t,n,d-1):BinSearch(e,t,d+1,o)}</script><div id=divForm><div id=divLogo></div><div id=divInGrid><center><input id=districtNum size=2 maxlength=2 readonly value=12> <input id=customNum size=11 maxlength=8 onchange=calcChkNum() oninput=calcChkNum() placeholder=用戶電號 type=search> <input id=chkNum size=1 maxlength=1 readonly></center></div><div id=divPole><input id=inPole size=11 readonly style=display:none></div><div id=divButton1><button class=button disabled id=btnOpenGM onclick=openGM() type=button></button> <button class=button disabled id=btnOpenOSM onclick=openOSM() type=button></button> <button class=button disabled id=btnOpenNLSC onclick=openNLSC() type=button></button> <button class=button disabled id=btnOpenLINE onclick=openLINE() type=button></button></div><script>var rows=[];document.getElementById("inPole").value="",$.getJSON("custom.json",(function(e){rows=e.slice()})).done((function(){document.getElementById("inPole").value="(1091209)"}))</script>>