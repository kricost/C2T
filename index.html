<html><meta name="viewport" content="width=device-width, initial-scale=.9, user-scalable=no"><meta name="theme-color" content="black" /><head><title>用戶變壓器定位</title> <script type="text/javascript" src="proj4.js"></script> <script type="text/javascript" src="./jquery-3.3.1.min.js"></script> <link id="theme" href="./style1.css" rel="stylesheet" tittle="style1"><style></style> <script>var latWGS84,lonWGS84,latTWD67TM2,lonTWD67TM2,gridTF;const idxLat=["2750000","2750000","2750000","2700000","2700000","2700000","2650000","2650000","2650000","2600000","2600000","2600000","2550000","2550000","2550000","2500000","2500000","2500000","2894000","2450000","2450000","2400000","2400000","2614000","2564000","2675800"],idxLon=["170000","250000","330000","170000","250000","330000","170000","250000","330000","090000","170000","250000","090000","170000","250000","090000","170000","250000","010000","170000","250000","170000","250000","275000","275000","010000"],alphabet=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];function openGM(){var e="https://www.google.com/maps/search/?api=1&query="+latWGS84.toFixed(6)+","+lonWGS84.toFixed(6);window.open(e,"_blank")}function openOSM(){var e="http://osm.org/?mlat="+latWGS84+"&mlon="+lonWGS84+"&#map=17/"+latWGS84+"/"+lonWGS84;window.open(e,"_blank")}function openNLSC(){var e="https://maps.nlsc.gov.tw/go/"+latWGS84+"/"+lonWGS84+"/";window.open(e,"_blank")}function openLINE(){var e="http://line.naver.jp/R/msg/text/?";e+=encodeURIComponent("電號：12-"+document.getElementById("customNum").value+"-"+document.getElementById("chkNum").value)+"%0D%0A"+encodeURIComponent("座標："+document.getElementById("inPole").value)+"%0D%0A"+("https://www.google.com/maps/search/?api=1&query="+latWGS84.toFixed(6)+","+lonWGS84.toFixed(6)),window.open(e,"_blank")}function calcChkNum(){document.getElementById("chkNum").value="";var e=document.getElementById("customNum").value.split(""),t=[2,1,2,1,2,1,2,1,2,1];if(8!=e.length)return document.getElementById("inPole").value="",void disableBtn();e.unshift(1,2);for(var n=0,o=0;o<e.length;o+=1)e[o]=e[o]*t[o],9<e[o]&&(e[o]-=9),n+=e[o];document.getElementById("chkNum").value=n%10,lookupGrid()}function lookupGrid(){str=document.getElementById("customNum").value;var e=BinSearch(rows,str,0,rows.length-1);e+1?(gridTF=rows[e][1],document.getElementById("inPole").value=gridTF,grid2twd67(),execConvert(),enableBtn()):(disableBtn(),document.getElementById("inPole").value="無此電號")}function grid2twd67(){grid=gridTF.toUpperCase();var e=+idxLat[alphabet.indexOf(grid[0])]+500*(10*grid[3]+ +grid[4])+100*+alphabet.indexOf(grid[6])+10*+grid[8];11==grid.length&&(e+=+grid[10]);var t=+idxLon[alphabet.indexOf(grid[0])]+800*(10*grid[1]+ +grid[2])+100*+alphabet.indexOf(grid[5])+10*+grid[7];11==grid.length&&(t+=+grid[9]),latTWD67TM2=e,lonTWD67TM2=t}function execConvert(){proj4.defs("EPSG:3828","+proj=tmerc +towgs84=-752,-358,-179,-.0000011698,.0000018398,.0000009822,.00002329 +lat_0=0 +lon_0=121 +x_0=250000 +y_0=0 +k=0.9999 +ellps=aust_SA +units=公尺"),proj4.defs("EPSG:3828:Liouciou","+proj=tmerc +lat_0=0 +lon_0=121 +x_0=249180 +y_0=1590 +k=0.9999 +ellps=aust_SA +units=公尺");var e=new proj4.Proj("EPSG:3828"),t=new proj4.Proj("EPSG:3828:Liouciou"),n=new proj4.Proj("EPSG:4326"),o=document.getElementById("customNum").value.toUpperCase(),t="T"===o[0]&&o.substr(1,2)<=20&&o.substr(3,2)<=50?t:e,e=[Number(lonTWD67TM2),Number(latTWD67TM2)],e=proj4(t,n,e);lonWGS84=e[0],latWGS84=e[1]}function disableBtn(){document.getElementById("btnOpenGM").disabled=!0,document.getElementById("btnOpenOSM").disabled=!0,document.getElementById("btnOpenNLSC").disabled=!0,document.getElementById("btnOpenLINE").disabled=!0}function enableBtn(){document.getElementById("btnOpenGM").disabled=!1,document.getElementById("btnOpenOSM").disabled=!1,document.getElementById("btnOpenNLSC").disabled=!1,document.getElementById("btnOpenLINE").disabled=!1}function BinSearch(e,t,n,o){if(o<n)return-1;var d=Math.floor((n+o)/2);return e[d][0]===t?d:e[d]>t?BinSearch(e,t,n,d-1):BinSearch(e,t,d+1,o)}</script> </head><body><div id="divForm"><div id="divLogo" onclick=""></div><div id="divInGrid"><center> <input type="text" value="12" id="districtNum" maxlength="2" size="2"readonly /> <input type="search" placeholder="用戶電號" id="customNum" maxlength="8" size="11" oninput="calcChkNum();" onchange="calcChkNum();" /> <input type="text" value="" id="chkNum" maxlength="1" size="1" readonly /></center></div><div id="divPole"> <input type="text" id="inPole" size="11" style="display:'none';" readonly /></div><div id="divButton1"> <button type="button" class="button" id="btnOpenGM" onclick="openGM()" disabled=true></button> <button type="button" class="button" id="btnOpenOSM" onclick="openOSM()" disabled=true></button> <button type="button" class="button" id="btnOpenNLSC" onclick="openNLSC()" disabled=true></button> <button type="button" class="button" id="btnOpenLINE" onclick="openLINE()" disabled=true></button></div> <script>var rows=[];document.getElementById("inPole").value="",$.getJSON("custom.json",function(e){rows=e.slice()}).done(function(){document.getElementById("inPole").value=""});</script> </body></html>
